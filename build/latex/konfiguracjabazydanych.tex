%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,polish]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}


\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Sonny]{fncychap}
\ChNameVar{\Large\normalfont\sffamily}
\ChTitleVar{\Large\normalfont\sffamily}
\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionspolish{\renewcommand{\contentsname}{Contents:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}



\title{Konfiguracja bazy danych}
\date{01 lip 2024}
\release{}
\author{Hubert Albanowsski, Filip Opac}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxstepscope


\chapter{Lokalizacja i struktura katalogów}
\label{\detokenize{rozdzialy/rozdzial1:lokalizacja-i-struktura-katalogow}}\label{\detokenize{rozdzialy/rozdzial1::doc}}

\section{Lokalizacja:}
\label{\detokenize{rozdzialy/rozdzial1:lokalizacja}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{)}%
\item {} \begin{description}
\sphinxlineitem{Katalog danych:}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{/var/lib/postgresql/\textless{}wersja\textgreater{}/main}} na na systemach Debian/Ubuntu

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{/var/lib/pgsql/\textless{}wersja\textgreater{}/data}} na systemach Red Hat/CentOS.

\item {} 
\sphinxAtStartPar
Zawiera wszystkie dane, pliki konfiguracyjne, logi i pliki kontrolne.

\end{itemize}

\end{description}

\item {} \begin{description}
\sphinxlineitem{Katalog Konfiguracyjny:}\begin{itemize}
\item {} 
\sphinxAtStartPar
Pliki konfiguracyjne zwykle znajdują się w katalogu danych, choć zdarza się, że mogą znajdować się w innym katalogu np \sphinxcode{\sphinxupquote{/etc/postgresql/\textless{}wersja\textgreater{}/main}}

\end{itemize}

\end{description}

\item {} \begin{description}
\sphinxlineitem{Katalog logów:}\begin{itemize}
\item {} 
\sphinxAtStartPar
Domyślnie \sphinxcode{\sphinxupquote{/var/log/postgresql}} na Debianie/Ubuntu oraz \sphinxcode{\sphinxupquote{/var/lib/pgsql/\textless{}wersja\textgreater{}/data/pg\_log}} na Red Har/CentOS

\item {} 
\sphinxAtStartPar
zawiera logi PostgreSQL

\end{itemize}

\end{description}

\end{enumerate}


\section{Struktura katalogów:}
\label{\detokenize{rozdzialy/rozdzial1:struktura-katalogow}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{base/}}: Zawiera dane użytkownika dla każdej bazy danych.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{global/}}: Przechowuje dane globalne, np. tabele systemowe.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{pg\_xlog/}} lub pg\_wal/ (od wersji 10): Zawiera dzienniki Write\sphinxhyphen{}Ahead Log (WAL).

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{pg\_clog/}} lub pg\_xact/: Przechowuje dane dotyczące transakcji.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{pg\_tblspc/}}: Linki symboliczne do tabel przestrzeni.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{pg\_multixact/}}: Dane dotyczące wielokrotnych transakcji.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{pg\_subtrans/}}: Dane dotyczące podrzędnych transakcji.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{pg\_stat/}}: Dane statystyczne.

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{pg\_snapshots/}}: Przechowuje dane dotyczące snapshotów.

\end{itemize}

\sphinxstepscope


\chapter{Tabele \sphinxhyphen{} rozmiar, planowanie i monitorowanie}
\label{\detokenize{rozdzialy/rozdzial2:tabele-rozmiar-planowanie-i-monitorowanie}}\label{\detokenize{rozdzialy/rozdzial2::doc}}

\section{Rozmiar}
\label{\detokenize{rozdzialy/rozdzial2:rozmiar}}
\sphinxAtStartPar
Rozmiar tabel można monitorować za pomocą poniższych zapytań SQL:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Dla jednej tabeli:}

\end{itemize}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{%
\PYG{k}{SELECT}\PYG{+w}{ }\PYG{n}{pg\PYGZus{}size\PYGZus{}pretty}\PYG{p}{(}\PYG{n}{pg\PYGZus{}total\PYGZus{}relation\PYGZus{}size}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}nazwa\PYGZus{}tabeli\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}%
}}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Dla wszystkich tabel:}

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{SELECT}\PYG{+w}{ }\PYG{n}{relname}\PYG{+w}{ }\PYG{k}{AS}\PYG{+w}{ }\PYG{l+s+ss}{\PYGZdq{}Table\PYGZdq{}}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{pg\PYGZus{}size\PYGZus{}pretty}\PYG{p}{(}\PYG{n}{pg\PYGZus{}total\PYGZus{}relation\PYGZus{}size}\PYG{p}{(}\PYG{n}{relid}\PYG{p}{)}\PYG{p}{)}\PYG{+w}{ }\PYG{k}{AS}\PYG{+w}{ }\PYG{l+s+ss}{\PYGZdq{}Size\PYGZdq{}}
\PYG{k}{FROM}\PYG{+w}{ }\PYG{n}{pg\PYGZus{}catalog}\PYG{p}{.}\PYG{n}{pg\PYGZus{}statio\PYGZus{}user\PYGZus{}tables}
\PYG{k}{ORDER}\PYG{+w}{ }\PYG{k}{BY}\PYG{+w}{ }\PYG{n}{pg\PYGZus{}total\PYGZus{}relation\PYGZus{}size}\PYG{p}{(}\PYG{n}{relid}\PYG{p}{)}\PYG{+w}{ }\PYG{k}{DESC}\PYG{p}{;}
\end{sphinxVerbatim}


\section{Planowanie}
\label{\detokenize{rozdzialy/rozdzial2:planowanie}}
\sphinxAtStartPar
Częścią planowania tabel jest:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{)}%
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Normalizacja} \sphinxhyphen{} Rozbijanie tabel na mniejsze by zmninimalizować powtarzanie danych i zależności.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Denormalizacja} \sphinxhyphen{} Łączenie tabel w większe i wprowadzanie redundancji w celu przyśpieszenia czasu zapytań.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Indeksowanie} \sphinxhyphen{} tworzenie indeksów w celu przyspieszenia przeszukiwań tabeli.

\end{enumerate}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{%
\PYG{k}{CREATE}\PYG{+w}{ }\PYG{k}{INDEX}\PYG{+w}{ }\PYG{n}{idx\PYGZus{}nazwa\PYGZus{}kolumny}\PYG{+w}{ }\PYG{k}{ON}\PYG{+w}{ }\PYG{n}{nazwa\PYGZus{}tabeli}\PYG{p}{(}\PYG{n}{nazwa\PYGZus{}kolumny}\PYG{p}{)}\PYG{p}{;}%
}}


\section{Monitorowanie}
\label{\detokenize{rozdzialy/rozdzial2:monitorowanie}}
\sphinxAtStartPar
Dodatkowo możlive jest monitorowanie wydajności tabel za pomocą:
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{pg\_stat\_user\_table:}

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{SELECT}\PYG{+w}{ }\PYG{n}{relname}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{seq\PYGZus{}scan}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{seq\PYGZus{}tup\PYGZus{}read}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{idx\PYGZus{}scan}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{idx\PYGZus{}tup\PYGZus{}fetch}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{n\PYGZus{}tup\PYGZus{}ins}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{n\PYGZus{}tup\PYGZus{}upd}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{n\PYGZus{}tup\PYGZus{}del}
\PYG{k}{FROM}\PYG{+w}{ }\PYG{n}{pg\PYGZus{}stat\PYGZus{}user\PYGZus{}tables}\PYG{p}{;}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{pg\_stat\_activity:}

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{SELECT}\PYG{+w}{ }\PYG{n}{pid}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{usename}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{datname}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{state}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{query\PYGZus{}start}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{query}
\PYG{k}{FROM}\PYG{+w}{ }\PYG{n}{pg\PYGZus{}stat\PYGZus{}activity}\PYG{p}{;}
\end{sphinxVerbatim}

\sphinxstepscope


\chapter{Podstawowe parametry konfiguracyjne}
\label{\detokenize{rozdzialy/rozdzial3:podstawowe-parametry-konfiguracyjne}}\label{\detokenize{rozdzialy/rozdzial3::doc}}

\section{Plik postgresql.conf}
\label{\detokenize{rozdzialy/rozdzial3:plik-postgresql-conf}}
\sphinxAtStartPar
Plik \sphinxstyleemphasis{postgresql.conf} zawiera ustawienia dotyczące wydajności, logowania, sieci i wielu innych aspektów.

\sphinxAtStartPar
\sphinxstylestrong{Kluczowe ustawienia:}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{)}%
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Słuchanie połączeń:}

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{listen\PYGZus{}addresses} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{localhost}\PYG{l+s+s1}{\PYGZsq{}}  \PYG{c+c1}{\PYGZsh{} Adresy IP, na których PostgreSQL będzie nasłuchiwać połączeń}
\PYG{n}{port} \PYG{o}{=} \PYG{l+m+mi}{5432}                     \PYG{c+c1}{\PYGZsh{} Port, na którym PostgreSQL będzie nasłuchiwać połączeń}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{)}%
\setcounter{enumi}{1}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Pamięć i wydajność:}

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{shared\PYGZus{}buffers} \PYG{o}{=} \PYG{l+m+mi}{128}\PYG{n}{MB}           \PYG{c+c1}{\PYGZsh{} Ilość pamięci RAM przeznaczona na buforowanie danych}
\PYG{n}{work\PYGZus{}mem} \PYG{o}{=} \PYG{l+m+mi}{4}\PYG{n}{MB}                   \PYG{c+c1}{\PYGZsh{} Ilość pamięci RAM na operacje sortowania i agregacji na użytkownika}
\PYG{n}{maintenance\PYGZus{}work\PYGZus{}mem} \PYG{o}{=} \PYG{l+m+mi}{64}\PYG{n}{MB}      \PYG{c+c1}{\PYGZsh{} Ilość pamięci RAM na operacje utrzymaniowe (np. VACUUM, CREATE INDEX)}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{)}%
\setcounter{enumi}{2}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Autovacuum:}

\end{enumerate}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{autovacuum} \PYG{o}{=} \PYG{n}{on}                  \PYG{c+c1}{\PYGZsh{} Automatyczne czyszczenie i analiza tabel}
\PYG{n}{autovacuum\PYGZus{}naptime} \PYG{o}{=} \PYG{l+m+mi}{1}\PYG{n+nb}{min}        \PYG{c+c1}{\PYGZsh{} Częstotliwość uruchamiania procesu autovacuum}
\end{sphinxVerbatim}


\bigskip\hrule\bigskip



\section{Plik pg\_hba.conf}
\label{\detokenize{rozdzialy/rozdzial3:plik-pg-hba-conf}}
\sphinxAtStartPar
Plik \sphinxstylestrong{pg\_hba.conf} odpowiada za kontrolę dostępu do bazy danych PostgreSQL.

\sphinxAtStartPar
\sphinxstylestrong{Przykład konfiguracji:}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} TYPE  DATABASE        USER            ADDRESS                 METHOD}

\PYG{c+c1}{\PYGZsh{} Zezwól lokalnym użytkownikom na połączenie}
\PYG{n}{local}   \PYG{n+nb}{all}             \PYG{n+nb}{all}                                     \PYG{n}{md5}

\PYG{c+c1}{\PYGZsh{} Zezwól zdalnym użytkownikom z sieci 192.168.1.0/24 na połączenie}
\PYG{n}{host}    \PYG{n+nb}{all}             \PYG{n+nb}{all}             \PYG{l+m+mf}{192.168}\PYG{l+m+mf}{.1}\PYG{l+m+mf}{.0}\PYG{o}{/}\PYG{l+m+mi}{24}          \PYG{n}{md5}
\end{sphinxVerbatim}


\section{Plik pg\_ident.conf}
\label{\detokenize{rozdzialy/rozdzial3:plik-pg-ident-conf}}
\sphinxAtStartPar
Plik \sphinxstylestrong{pg\_ident.conf} pozwala mapować systemowych użytkowników do użytkowników PostgreSQL.

\sphinxAtStartPar
\sphinxstylestrong{Przykład konfiguracji:}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} MAPNAME       SYSTEM\PYGZhy{}USERNAME         PG\PYGZhy{}USERNAME}

\PYG{n}{mymap}           \PYG{n}{johndoe}                 \PYG{n}{john}
\PYG{n}{mymap}           \PYG{n}{janedoe}                 \PYG{n}{jane}
\end{sphinxVerbatim}

\sphinxAtStartPar
W pliku \sphinxstylestrong{pg\_hba.conf} można użyć tej mapy:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{host}    \PYG{n+nb}{all}             \PYG{n+nb}{all}             \PYG{l+m+mf}{127.0}\PYG{l+m+mf}{.0}\PYG{l+m+mf}{.1}\PYG{o}{/}\PYG{l+m+mi}{32}            \PYG{n}{ident} \PYG{n+nb}{map}\PYG{o}{=}\PYG{n}{mymap}
\end{sphinxVerbatim}


\chapter{Indices and tables}
\label{\detokenize{index:indices-and-tables}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{genindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{modindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{search}

\end{itemize}



\renewcommand{\indexname}{Indeks}
\printindex
\end{document}